{% extends "base.html" %}
{% block main_content %}

<style>
.admin-container {
    max-width: 1000px;
    margin: auto;
}

.admin-card {
    background: #1e1e1e;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
}

.admin-card h3 {
    margin-top: 0;
}

.admin-table {
    width: 100%;
    border-collapse: collapse;
}

.admin-table th, .admin-table td {
    padding: 8px;
    border-bottom: 1px solid #333;
}

.admin-table th {
    background: #2a2a2a;
}

button {
    padding: 6px 10px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}

.delete-btn { background: #ff4d4d; color: white; }
.update-btn { background: #4CAF50; color: white; }
</style>

<div class="admin-container">

<div class="admin-card">
    <h2>Admin Panel</h2>
    <p>Всего пользователей: <strong>{{ total_users }}</strong></p>
</div>

<div class="admin-card">
    <h3>Онлайн пользователи</h3>
    <ul>
    {% for id, data in online_users.items() %}
        <li>{{ data.username }} | {{ data.ip }} | {{ data.user_agent }}</li>
    {% endfor %}
    </ul>
</div>

<div class="admin-card">
    <h3>Пользователи</h3>

    <table class="admin-table">
        <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Actions</th>
        </tr>

        {% for user in users %}
        <tr>
            <td>{{ user[0] }}</td>
            <td>{{ user[1] }}</td>
            <td>

                <!-- Delete -->
                <form method="POST" style="display:inline;">
                    <input type="hidden" name="action" value="delete">
                    <input type="hidden" name="user_id" value="{{ user[0] }}">
                    <button class="delete-btn">Delete</button>
                </form>

                <!-- Update username -->
                <form method="POST" style="display:inline;">
                    <input type="hidden" name="action" value="update_username">
                    <input type="hidden" name="user_id" value="{{ user[0] }}">
                    <input type="text" name="new_username" placeholder="new username">
                    <button class="update-btn">Update</button>
                </form>

                <!-- Update password -->
                <form method="POST" style="display:inline;">
                    <input type="hidden" name="action" value="update_password">
                    <input type="hidden" name="user_id" value="{{ user[0] }}">
                    <input type="text" name="new_password" placeholder="new password">
                    <button class="update-btn">Password</button>
                </form>

            </td>
        </tr>
        {% endfor %}
    </table>
</div>

<div class="admin-card">
    <h3>Последние входы</h3>
    <table class="admin-table">
        <tr>
            <th>User</th>
            <th>IP</th>
            <th>Device</th>
            <th>Time</th>
        </tr>
        {% for log in logs %}
        <tr>
            <td>{{ log[0] }}</td>
            <td>{{ log[1] }}</td>
            <td>{{ log[2] }}</td>
            <td>{{ log[3] }}</td>
        </tr>
        {% endfor %}
    </table>
</div>

</div>

{% endblock %}
