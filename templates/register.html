{% extends "base.html" %}

{% block auth_content %}

<div class="auth-box">

    <div class="auth-logo">
        <img src="{{ url_for('static', filename='lone-icon.png') }}" alt="Lone Icon">
        <span class="auth-title">Lone</span>
    </div>

    <p class="auth-sub">Создание аккаунта</p>

    <form method="POST" id="register-form">
        {{ form.hidden_tag() }}

        <div class="input-group">
            {{ form.username(placeholder="Username", id="username") }}
        </div>

        <div class="input-group">
            {{ form.password(placeholder="Пароль", id="password") }}
        </div>

        <div id="register-feedback" class="feedback">
            {% with messages = get_flashed_messages() %}
            {% if messages %}
                {{ messages[0] }}
            {% endif %}
            {% endwith %}
        </div>

        <button class="auth-btn" type="submit">Создать аккаунт</button>
    </form>

    <p class="auth-switch">
        Уже есть аккаунт?
        <span class="auth-link" onclick="window.location='{{ url_for('login') }}'">Войти</span>
    </p>
</div>

<script>
const regForm = document.getElementById('register-form');
const regFeedback = document.getElementById('register-feedback');
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');

// Приводим username к нижнему регистру сразу
usernameInput.addEventListener('input', () => {
    usernameInput.value = usernameInput.value.toLowerCase();
});

regForm.addEventListener('submit', (e) => {
    const username = usernameInput.value.trim();
    const password = passwordInput.value.trim();
    regFeedback.innerHTML = '';

    // Проверка username
    if (!/^[a-z0-9_]{4,10}$/.test(username)) {
        e.preventDefault();
        regFeedback.innerHTML = 'Username: 4-10 символов, латиница, цифры, _';
        return;
    }

    // Проверка пароля
    if (!/^[a-zA-Z0-9]{6,32}$/.test(password)) {
        e.preventDefault();
        regFeedback.innerHTML = 'Пароль: 6-32 символа, латиница и цифры';
        return;
    }
});
</script>

{% endblock %}
